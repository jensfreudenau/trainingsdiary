<!DOCTYPE html>
<html> 
<head> 
   <meta http-equiv="content-type" content="text/html; charset=UTF-8"/> 
   <title>Google Maps JavaScript API v3 Example: Directions Complex</title> 
   <script type="text/javascript" 
           src="http://maps.google.com/maps/api/js?sensor=false"></script>
</head> 
<body style="font-family: Arial; font-size: 13px; color: red;" onload="init()"> 
   <div id="map" style="width: 800px; height: 500px;"></div> 
   <div id="duration">Duration: </div> 
   <div id="distance">Distance: </div> 
</body> 

   <script type="text/javascript"> 
    var poly;
    var path               = [];
    var directionsService  = new google.maps.DirectionsService();
    var directionsDisplay  = new google.maps.DirectionsRenderer();
    var meters             = 0;
    var mousemarker = null;
    var markers = [];
    var shiftPressed       = false;
    google.maps.event.addDomListener(document, "keydown", function() { shiftPressed = true; });
    google.maps.event.addDomListener(document, "keyup", function() { shiftPressed = false; });

   var myOptions = {
        zoom: 14,
        center: new google.maps.LatLng(52.48565056551106, 13.35172131164552),
        mapTypeId: google.maps.MapTypeId.ROADMAP,        
        mapTypeControlOptions: {
          mapTypeIds: [google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.HYBRID, google.maps.MapTypeId.SATELLITE]
        },
        //disableDoubleClickZoom: true,
        //scrollwheel: false,
        draggableCursor: "crosshair"
      }
   var map = new google.maps.Map(document.getElementById("map"), myOptions);
   

   // Add a marker and trigger recalculation of the path and elevation
  function addMarker(latlng) {
    if (markers.length < 10) {
      
      var marker = new google.maps.Marker({
        position: latlng,
        map: map,
        draggable: true
      })
      
      google.maps.event.addListener(marker, 'dragend', function(e) {
        calc();
      });
      
      markers.push(marker);
      
       
      
      if (markers.length == 10) {
        document.getElementById('address').disabled = true;
      }
    } else {
      alert("No more than 10 points can be added");
    }
  }

   function calc() {
    
    google.maps.event.addListener(map, "click", function(evt) {

      if (shiftPressed || path.length == 0) {
          path.push(evt.latLng);
          if (path.length == 1) {
            poly = new google.maps.Polyline({ map: map });
          }
          poly.setPath(path);
        } else 
        {
          var options = { 
            origin: path[path.length - 1], 
            destination: evt.latLng,
            travelMode: google.maps.DirectionsTravelMode.WALKING 
          };
          directionsService.route(options, function(result, status) {
            if (status == google.maps.DirectionsStatus.OK) {
               
              path = path.concat(result.routes[0].overview_path);
              poly.setPath(path);              
            }
          });
        }
        addMarker(evt.latLng);
        var request = {
          origin: path[path.length - 1],
          destination: evt.latLng,          
          travelMode: google.maps.TravelMode.WALKING,
          unitSystem: google.maps.UnitSystem.METRIC,
          waypoints:[{location: path[0]}]

        };
        directionsService.route(request, function(response, status) {
          if (status == google.maps.DirectionsStatus.OK) {
            meters += response.routes[0].legs[0].distance.value;
            document.getElementById('distance').innerHTML = meters + " meters";
            directionsDisplay.setDirections(response);
          }
        });
    });   
  }

  function init() {    
     // map = new google.maps.Map(document.getElementById("map"), myOptions);
      directionsDisplay = new google.maps.DirectionsRenderer();
      calc();
   }
   </script> 

</html>